document.addEventListener("DOMContentLoaded",()=>{const e={limits:{maxSessionLines:100,maxRandomLogs:30,hardCap:500},timing:{initialBootGreen:1500,bootLogDelay:400,randomLogMin:2e3,randomLogMax:5e3,panicDuration:5e3,panicSpamInterval:400,nukeCountdownInterval:1e3,nukeDuration:5,bsodRebootDelay:4500,bsodAnimationDuration:2600,bsodAnimationStep:40,danceDuration:5e3,guardBlinkDuration:700},network:{latencyMin:5,latencyMax:85,lossSpikeProbability:.15,lossNormalMax:3,lossSpikeMin:5,lossSpikeMax:20,unstableThreshold:10},thresholds:{loadWarn:50,loadFail:75},probabilities:{summonSuccess:.8,weirdLogs:.05},asciiArt:{minLines:40,maxLines:80,minLinesAfter:50,maxLinesAfter:100},statusUpdate:{slowInterval:1e4,fastInterval:5e3},security:{nukePassword:"whydoesthiswork"},computed:{bsodSteps:0,bsodPerStep:0}};e.computed.bsodSteps=Math.ceil(e.timing.bsodAnimationDuration/e.timing.bsodAnimationStep),e.computed.bsodPerStep=Math.ceil(100/e.computed.bsodSteps);const t=Object.freeze({NORMAL:"normal",PANIC:"panic",NUKE:"nuke",BSOD:"bsod"}),n=Object.freeze({OK:"ok",WARN:"warn",FAIL:"fail",MELTDOWN:"meltdown",INSTABILITY:"instability"}),a=[{key:"panic",id:"panic-overlay",innerClass:"panic-inner",contentId:"panic-content",children:[{className:"panic-text",text:"!! SYSTEM INSTABILITY DETECTED !!"},{className:"panic-text",text:"CONTAINMENT FAILURE POSSIBLE"},{className:"panic-text small",text:"attempting graceful denial..."}]},{key:"bsod",id:"bsod-overlay",innerClass:"bsod-inner",contentId:"bsod-content"},{key:"dance",id:"dance-overlay",innerClass:"dance-inner",contentId:"dance-content"}],o=[{key:"cpu",label:"CPU",valueId:"cpu-val",initialValue:"--%",barId:"cpu-bar",footId:"cpu-foot",footText:"process priority: vibes"},{key:"mem",label:"MEM",valueId:"mem-val",initialValue:"-- MB",barId:"mem-bar",footId:"mem-foot",footText:"leaks classified as features"},{key:"temp",label:"TEMP",valueId:"temp-val",initialValue:"--°C",barId:"temp-bar",footId:"temp-foot",footText:"thermal status: questionable",cardId:"temp-card"},{key:"net",label:"NET",valueId:"net-val",initialValue:"--",footId:"net-foot",footText:"uplink: -- | latency: -- ms | packet_loss: --% | status: questionable"}],i=[{type:"button",label:"help",cmd:"help",title:"Show available commands",controls:"mainLog"},{type:"button",label:"/summon",cmd:"/summon",title:"Summon AI assistant",controls:"mainLog"},{type:"button",label:"/dance",cmd:"/dance",title:"Trigger dance animation",controls:"dance-overlay",extraClasses:"cmd-fun"},{type:"button",label:"/panic",cmd:"/panic",title:"Trigger system panic alert",controls:"panic-overlay",extraClasses:"cmd-warn"},{type:"guard"},{type:"button",label:"clear",cmd:"clear",title:"Clear log output",controls:"output"}],s=Object.freeze({pickRandom:e=>e[Math.random()*e.length|0],randBetween:(e,t)=>(Math.random()*(t-e+1)|0)+e});function c(e,t){e&&(e.textContent=t)}let r=t.NORMAL;const l=()=>r!==t.NORMAL,d=e=>{r=e},u=["╔═══════════════════════════════════════╗","║          whydoesthiswork.com          ║","║        it runs. somehow. maybe.       ║","╚═══════════════════════════════════════╝","",""].join("\n"),m=["[sys] ── boot sequence started","[boot] mounting unstable container..............  [==>        ]  23%","[ok] local model jammed into RAM. questionable. [====>      ]  47%","[warn] token buffer overflow ignored.           [=======>   ]  65%","[info] patching logic with tape.                  [========>  ]  78%","[fail] reasoning module missing. using vibes.   [=========> ]  89%","[ok] model now hallucinating confidently.       [==========>] 100%","[sys] serving at whydoesthiswork.com",""],p=["[debug] shuffling attention weights...","[info] running out of tokens, trying anyway.","[ok] sanity check skipped (as usual).","[sys] memory leaks embraced as personality.","[log] parsing markdown with violence.","[debug] retraining based on vibes...","[info] chat loop complete. starting over.","[ok] output sounds confident. must be right.","[trace] hallucination.c: line 42","[sys] YOLO mode engaged.","[note] tokens are people too.","[debug] cache hit rate: suspicious.","[info] tokens flowing smoothly.","[ok] all systems nominal (probably).","[sys] background tasks humming along.","[log] context window expanded.","[debug] attention heads aligned.","[info] processing batch quietly.","[ok] latency within acceptable range.","[sys] memory management: stable.","[log] inference cycle complete.","[debug] temperature set to default.","[info] context preserved.","[ok] checkpoint saved.","[sys] idle cycles utilized.","[log] batch processed.","[warn] latency spike blamed on the user.","[fail] tried logic. got sarcasm."],f=["[???] unexpected clarity detected.","[glitch] ¯\\_(ツ)_/¯ protocol initiated.","[sys] echo chamber feedback loop engaged.","[note] reality index drifting off baseline.","[err] sanity check failed: 'NaN'","[ghost] who coded this?","[glitch] ~s̷y̴s̷t̸e̷m̷~"],h=["              \n        (\\-^-/)\n        |=   =|\n        | ___ |\n       /:_____:\\\n       \\/_# #_\\//\n       /|\\\\_=_/|\\\\\n       \\\\_\\\\___/_/\n        /_/ \\\\_\\\\\n      [robot-01]","       .-.\n      (o o)\n      | O \\\n       \\   \\_\n      .-\\___)=-.\n     /         \\\n    /  ~ AI ~   \\\n    \\  spirit  /\n     '._   _.'\n        `-'\n      [cryptid]","      /\\\n     /  \\    _  _\n    / /\\ \\  ( \\/ )\n   / ____ \\  \\  /\n  /_/    \\_\\  \\/\n   ( ascii mothman )\n"],b=document.querySelector(".console-shell"),g=document.getElementById("output"),y=document.getElementById("cmdline"),v=document.querySelector(".cmd-bar"),k=document.getElementById("themeToggle"),A=document.querySelector(".log-panel"),I=document.getElementById("overlay-root"),{overlays:T,contents:E}=function(e){const t={},n={};if(!e)return{overlays:t,contents:n};const o=a.map(e=>{const a=document.createElement("div");a.id=e.id,a.setAttribute("role","dialog"),a.setAttribute("aria-modal","true"),a.hidden=!0;const o=C(e.innerClass||"");if(e.contentId&&(o.id=e.contentId),e.children?.length){N(o,...e.children.map(e=>C(e.className,e.text)))}return a.appendChild(o),t[e.key]=a,n[e.key]=o,a});return e.replaceWith(...o),{overlays:t,contents:n}}(I);!function(e){if(!e)return;const t=i.map(e=>"button"===e.type?function(e){const t=document.createElement("button");t.className=["cmd-btn",e.extraClasses].filter(Boolean).join(" "),t.dataset.cmd=e.cmd,t.type="button",t.title=e.title,e.controls&&t.setAttribute("aria-controls",e.controls);return t.textContent=e.label,t}(e):"guard"===e.type?function(){const e=document.createElement("div");e.className="nuke-guard";const t=document.createElement("button");t.className="cmd-btn cmd-danger nuke-btn",t.dataset.cmd="/nuke",t.type="button",t.id="nuke-btn",t.title="Nuclear option - requires authentication",t.setAttribute("aria-controls","bsod-overlay auth-overlay"),t.disabled=!0,t.textContent="/nuke";const n=C("guard-hinge"),a=document.createElement("button");a.className="guard-cover",a.id="guard-switch",a.type="button",a.setAttribute("aria-pressed","false"),a.setAttribute("aria-label","Safety guard - click to open"),a.title="Guard closed – click to open",a.setAttribute("aria-controls","nuke-btn");const o=document.createElement("span");return o.className="guard-label-main",o.textContent="DANGER",a.appendChild(o),e.append(t,n,a),e}():null).filter(Boolean);N(e,...t)}(document.getElementById("cmd-buttons"));const w={panic:T.panic||document.getElementById("panic-overlay"),bsod:T.bsod||document.getElementById("bsod-overlay"),dance:T.dance||document.getElementById("dance-overlay"),auth:document.getElementById("auth-overlay")},L=E.panic||document.getElementById("panic-content"),x=E.bsod||document.getElementById("bsod-content"),M=document.getElementById("auth-content");function C(e,t){const n=document.createElement("div");return n.className=e,void 0!==t&&(n.textContent=t),n}function N(e,...t){if(e)if("function"!=typeof e.replaceChildren){for(;e.firstChild;)e.removeChild(e.firstChild);t.forEach(t=>e.appendChild(t))}else e.replaceChildren(...t)}const S=function(e){if(!e)return o.reduce((e,t)=>{const n={val:document.getElementById(t.valueId),foot:document.getElementById(t.footId)};return t.barId&&(n.bar=document.getElementById(t.barId)),e[t.key]=n,e},{});const t={};return N(e,...o.map(e=>{const n=document.createElement("div");n.className="status-card",e.cardId&&(n.id=e.cardId);const a=C("status-head"),o=document.createElement("span");o.className="status-label",o.textContent=e.label;const i=document.createElement("span");i.className="status-val",i.textContent=e.initialValue,i.id=e.valueId,i.setAttribute("role","status"),a.append(o,i);const s={val:i};if(e.barId){const t=C("status-bar-wrap"),o=C("status-bar-fill ok");o.id=e.barId,t.appendChild(o),n.append(a,t),s.bar=o}else n.appendChild(a);const c=C("status-foot",e.footText);return c.id=e.footId,n.appendChild(c),s.foot=c,t[e.key]=s,n})),t}(document.getElementById("status-grid"));let B=null;function O(e,t){B=document.activeElement instanceof HTMLElement?document.activeElement:null,e?.removeAttribute("hidden"),e?.classList.add("active"),e?.setAttribute("aria-hidden","false");const n=t||e;n?.hasAttribute("tabindex")||n?.setAttribute("tabindex","-1"),n?.focus({preventScroll:!0})}function R(e){e?.classList.remove("active"),e?.setAttribute("aria-hidden","true"),e?.setAttribute("hidden",""),B&&document.contains(B)?B.focus({preventScroll:!0}):y?.focus({preventScroll:!0})}const _={open(e,t,n){n?.(),O(e,t)},close(e,t){R(e),t?.()},temporary(e,t,n,a){this.open(e,null,n),setTimeout(()=>{this.close(e,a)},t)}};const q=new class{constructor(){this.intervals=new Set,this.timeouts=new Set}addInterval(e){return this.intervals.add(e),e}addTimeout(e){return this.timeouts.add(e),e}clear(e){this.intervals.has(e)&&(clearInterval(e),this.intervals.delete(e)),this.timeouts.has(e)&&(clearTimeout(e),this.timeouts.delete(e))}clearAll(){this.intervals.forEach(clearInterval),this.timeouts.forEach(clearTimeout),this.intervals.clear(),this.timeouts.clear()}};function D(e,t){const n=setInterval(()=>{document.hidden||t()},e);return q.addInterval(n)}function V(e,t){const n=setTimeout(()=>{document.hidden||e()},t);return q.addTimeout(n)}function $(){const t=function(){const e=["idle","rx","tx","link?","??"];return s.pickRandom(e)}(),n=s.randBetween(e.network.latencyMin,e.network.latencyMax),a=Math.random()<e.network.lossSpikeProbability?s.randBetween(e.network.lossSpikeMin,e.network.lossSpikeMax):s.randBetween(0,e.network.lossNormalMax);Object.assign(Q,{netMode:t,latencyMs:n,lossPct:a});const o=a>e.network.unstableThreshold?"unstable":"questionable";c(S.net.val,t),c(S.net.foot,`uplink: ${t} | latency: ${n} ms | packet_loss: ${a}% | status: ${o}`)}function P(e){b&&(b.dataset.theme=e),c(k,`mode: ${e}`),k?.setAttribute("aria-pressed",String("dark"===e))}let W;document.addEventListener("visibilitychange",()=>{document.hidden?(q.clearAll(),ae=!1):oe()}),k?.addEventListener("click",function(){const e="dark"===b?.dataset.theme?"light":"dark";P(e),localStorage.setItem("themeMode",e),K()}),function(){const e=localStorage.getItem("themeMode");e&&P(e)}();let F=0;function G(){return W||(W=new(window.AudioContext||window.webkitAudioContext)),"suspended"===W.state&&W.resume().catch(()=>{}),W}function Y(){const e=G();return"suspended"===e.state?e.resume().then(()=>e).catch(()=>e):Promise.resolve(e)}function U(e){return(...t)=>{try{return e(...t)}catch(e){console.warn("Audio error:",e)}}}const K=U(()=>{if(performance.now()-F<200)return;const e=G(),t=e.currentTime,n=e.createOscillator(),a=e.createGain();n.type="square",n.frequency.value=600,n.connect(a),a.connect(e.destination),a.gain.setValueAtTime(1e-4,t),a.gain.linearRampToValueAtTime(.15,t+.01),a.gain.exponentialRampToValueAtTime(1e-4,t+.08),n.start(t),n.stop(t+.09)}),j=U(()=>{F=performance.now();const e=G(),t=e.createOscillator(),n=e.createGain();t.type="sawtooth",t.frequency.value=220,t.connect(n),n.connect(e.destination);const a=e.currentTime;n.gain.setValueAtTime(1e-4,a),n.gain.exponentialRampToValueAtTime(.15,a+.02),t.start(a),t.frequency.exponentialRampToValueAtTime(110,a+.12),n.gain.exponentialRampToValueAtTime(1e-4,a+.14),t.stop(a+.16)}),H=U(()=>{const e=G(),t=e.currentTime;function n(n,a){const o=e.createOscillator(),i=e.createGain();o.type="square",o.frequency.value=n,o.connect(i),i.connect(e.destination),i.gain.setValueAtTime(1e-4,t+a),i.gain.linearRampToValueAtTime(.2,t+a+.01),i.gain.exponentialRampToValueAtTime(1e-4,t+a+.35),o.start(t+a),o.stop(t+a+.4)}for(let e=0;e<12;e++){n(e%2==0?440:220,.4*e)}});const z=U(()=>{const e=G(),t=e.currentTime;function n(n,a,o){const i=e.createOscillator(),s=e.createGain();i.type="square",i.frequency.value=n,i.connect(s),s.connect(e.destination),s.gain.setValueAtTime(1e-4,t),s.gain.linearRampToValueAtTime(o,t+.01),s.gain.exponentialRampToValueAtTime(1e-4,t+a),i.start(t),i.stop(t+a+.02)}n(440,.4,.3),n(622,.4,.2),n(880,.4,.2),n(110,.6,.15)});let X=new Set;const J=U(()=>{const e=G(),t=.4,n=[440,523,659,523];for(let a=0;a<5;a++){const o=e.currentTime+a*t*4;n.forEach((n,a)=>{const i=e.createOscillator(),s=e.createGain();i.type="square",i.frequency.value=n,i.connect(s),s.connect(e.destination),s.gain.setValueAtTime(.14,o+a*t),s.gain.linearRampToValueAtTime(1e-4,o+a*t+.9*t),i.start(o+a*t),i.stop(o+a*t+t),X.add(i),X.add(s)});for(let n=0;n<4;n++){const a=e.createOscillator(),i=e.createGain();a.type="square",a.frequency.value=110,a.connect(i),i.connect(e.destination),i.gain.setValueAtTime(.09,o+n*t),i.gain.linearRampToValueAtTime(1e-4,o+n*t+t),a.start(o+n*t),a.stop(o+n*t+t),X.add(a),X.add(i)}const i=e.createOscillator(),s=e.createGain();i.type="triangle",i.frequency.setValueAtTime(120,o),i.connect(s),s.connect(e.destination),s.gain.setValueAtTime(.25,o),i.frequency.exponentialRampToValueAtTime(50,o+.08),s.gain.exponentialRampToValueAtTime(1e-4,o+.12),i.start(o),i.stop(o+.13),X.add(i),X.add(s);const c=e.createOscillator(),r=e.createGain();c.type="square",c.frequency.setValueAtTime(300,o+.8),c.connect(r),r.connect(e.destination),r.gain.setValueAtTime(.12,o+.8),r.gain.exponentialRampToValueAtTime(1e-4,o+.8+.08),c.start(o+.8),c.stop(o+.8+.09),X.add(c),X.add(r)}});let Q={cpu:0,mem:0,temp:0,netMode:"idle",latencyMs:0,lossPct:0},Z=!0;function ee(e){return e?.classList.contains(n.INSTABILITY)||e?.classList.contains(n.MELTDOWN)}function te(){[S.cpu.bar,S.mem.bar,S.temp.bar].forEach(e=>e?.classList.remove(n.MELTDOWN))}function ne(){let t=Z?5:Math.floor(101*Math.random()),a=Z?100:Math.floor(1001*Math.random()),o=Z?35:Math.floor(101*Math.random());t=Math.min(Math.max(t,0),100),a=Math.min(Math.max(a,0),1e3),o=Math.min(Math.max(o,0),100);const i=t,s=a/1e3*100,r=o;Q.cpu=t,Q.mem=a,Q.temp=o;ee(S.cpu.bar)||ee(S.mem.bar)||ee(S.temp.bar)||(c(S.cpu.val,`${t}%`),c(S.mem.val,`${a} MB`),c(S.temp.val,`${o} °C`));if([{el:S.cpu.bar,widthPct:i},{el:S.mem.bar,widthPct:s},{el:S.temp.bar,widthPct:r}].forEach(({el:t,widthPct:a})=>{if(ee(t)||t&&(t.style.width=`${Math.min(a,100)}%`),!ee(t))if(!Z||t!==S.cpu.bar&&t!==S.mem.bar&&t!==S.temp.bar){const i=(o=a)<e.thresholds.loadWarn?n.OK:o<e.thresholds.loadFail?n.WARN:n.FAIL;t?.classList.remove(n.OK,n.WARN,n.FAIL),t?.classList.add(i)}else t?.classList.remove(n.OK,n.WARN,n.FAIL,n.MELTDOWN,n.INSTABILITY),t?.classList.add(n.OK);var o}),!ee(S.cpu.bar)){const t=i>=e.thresholds.loadFail?"process priority: degraded":i>=e.thresholds.loadWarn?"process priority: questionable":"process priority: looks good (i think)";c(S.cpu.foot,t)}if(!ee(S.mem.bar)){const t=s>=e.thresholds.loadFail?"memory status: leaking":s>=e.thresholds.loadWarn?"memory status: questionable":"memory status: should be sufficient";c(S.mem.foot,t)}if(!ee(S.temp.bar)){const t=o>=e.thresholds.loadFail?"thermal status: screaming":o>=e.thresholds.loadWarn?"thermal status: warm-ish":"thermal status: questionable";c(S.temp.foot,t)}}setTimeout(()=>{Z=!1},e.timing.initialBootGreen);let ae=!1;function oe(){ae||(ae=!0,ne(),$(),D(e.statusUpdate.slowInterval,ne),D(e.statusUpdate.fastInterval,$))}oe(),g.textContent=`${u}\n`;let ie=[],se="",ce=0,re=0,le=s.randBetween(e.asciiArt.minLines,e.asciiArt.maxLines),de=0;const ue=/^\[(glitch|\?\?\?|err|ghost)\]/,me={"[ok]":"log-ok","[warn]":"log-warn","[fail]":"log-fail"};function pe(t,n){de>=e.limits.maxSessionLines&&(g.textContent="[sys] log buffer rotated.\n",ie=[],re=0,le=s.randBetween(e.asciiArt.minLines,e.asciiArt.maxLines),de=1);const a=A,o=a.scrollTop+a.clientHeight>=a.scrollHeight-10,i=document.createDocumentFragment();if(n&&!l()&&++re>=le){const t=document.createElement("pre");t.className="ascii-block",t.textContent=`${s.pickRandom(h)}\n`,t.setAttribute("aria-hidden","true"),i.appendChild(t),ie.push(t),re=0,le=s.randBetween(e.asciiArt.minLinesAfter,e.asciiArt.maxLinesAfter)}const c=document.createElement("span");c.textContent=`${t}\n`;const r=t.substring(0,t.indexOf("]")+1);if(me[r]?c.classList.add(me[r]):ue.test(t)&&c.classList.add("log-glitch"),i.appendChild(c),n&&ie.push(c),g.appendChild(i),de++,ie.length>e.limits.maxRandomLogs){ie.splice(0,ie.length-e.limits.maxRandomLogs).forEach(e=>e?.remove())}for(;g.childNodes.length>e.limits.hardCap;)g.firstChild?.remove();!function(e,t){e&&t&&requestAnimationFrame(()=>{e.scrollTop=e.scrollHeight})}(a,o)}function fe(){const t=Math.floor(Math.random()*(e.timing.randomLogMax-e.timing.randomLogMin))+e.timing.randomLogMin;if(l())return void V(fe,t);const n=Math.random()<e.probabilities.weirdLogs?f:p;let a;do{a=s.pickRandom(n)}while(a===se);se=a,pe(a,!0),"requestIdleCallback"in window?requestIdleCallback(()=>V(fe,t),{timeout:t}):V(fe,t)}V(function t(){l()?V(t,e.timing.bootLogDelay):ce<m.length?(pe(m[ce++],!1),V(t,e.timing.bootLogDelay)):V(fe,1e3)},800);let he=!1,be=null;function ge(e=250){be&&q.clear(be),be=D(e,()=>{Y().then(e=>{const t=e.currentTime,n=e.createOscillator(),a=e.createGain();n.type="square",n.frequency.value=880,n.connect(a),a.connect(e.destination),a.gain.setValueAtTime(1e-4,t),a.gain.linearRampToValueAtTime(.18,t+.008),a.gain.exponentialRampToValueAtTime(1e-4,t+.09),n.start(t),n.stop(t+.1)}).catch(()=>{})})}function ye(){be&&(q.clear(be),be=null)}function ve(){return new Promise(t=>{if(!w.auth||!M)return t(null);O(w.auth,M);const n=document.getElementById("auth-input"),a=document.getElementById("auth-ok"),o=document.getElementById("auth-cancel"),i=document.getElementById("auth-error");i&&(i.style.display="none"),n&&(n.value="",setTimeout(()=>n.focus({preventScroll:!0}),0));const s=()=>{const a=(n?.value||"").trim();a?a===e.security.nukePassword?(d(),t(!0)):(d(),t(!1)):i&&(i.style.display="block")},c=()=>{d(),t(null)};function r(e){"Enter"===e.key&&(e.preventDefault(),s()),"Escape"===e.key&&(e.preventDefault(),c())}function l(){i&&(i.style.display="none")}function d(){document.removeEventListener("keydown",r,!0),n?.removeEventListener("input",l),a?.removeEventListener("click",s),o?.removeEventListener("click",c),R(w.auth)}n?.addEventListener("input",l),a?.addEventListener("click",s),o?.addEventListener("click",c),document.addEventListener("keydown",r,!0)})}function ke(){if(he)return;if(!L||!w.panic)return void Ae("panic overlay unavailable.");he=!0,d(t.NUKE),[S.cpu.bar,S.mem.bar,S.temp.bar].forEach(e=>{e?.classList.remove(n.OK,n.WARN,n.FAIL,n.INSTABILITY),e?.classList.add(n.MELTDOWN)}),c(S.cpu.foot,"cpu status: cascading failure"),c(S.mem.foot,"ram status: bitrot detected"),c(S.temp.foot,"thermal status: runaway"),c(S.net.val,"DOWN"),c(S.net.foot,"uplink: DISCONNECTED | latency: ∞ ms | packet_loss: 100% | status: HARD FAIL"),c(S.cpu.val,"!!!"),c(S.mem.val,"!!!"),c(S.temp.val,"!!!");let a=e.timing.nukeDuration;N(L);const o=document.createElement("div");o.className="panic-countdown-big";const i=document.createElement("span");i.id="panic-count",i.textContent=`T-${a}`,o.appendChild(i);const r=document.createElement("div");r.className="panic-caption",r.textContent="NUCLEAR RELEASE ARMED";const l=document.createElement("div");l.className="panic-text small",l.textContent="please remain calm",L.appendChild(o),L.appendChild(r),L.appendChild(l),O(w.panic,L),pe("[warn] nuclear option armed. stand by.",!1),ge(250);const u=i,m=q.addInterval(setInterval(()=>{a--,a>0?(u&&(u.textContent=`T-${a}`),pe(`[warn] T-${a}`,!1)):(ye(),q.clear(m),R(w.panic),function(){if(!x||!w.bsod)return void Ae("bsod overlay unavailable.");pe("[fail] /nuke executed. system halt requested.",!1),w.bsod?.classList.add("active"),w.bsod?.setAttribute("aria-hidden","false"),w.bsod?.removeAttribute("hidden"),z();const n=function(e){if(!e)return null;const t=C("bsod-face",":("),n=C("bsod-msg");n.append("Your system ran into a problem and needs to restart.",document.createElement("br"),"We're just collecting some error info, and then we'll restart for you.");const a=C("bsod-msg"),o=document.createElement("span");return o.id="bsod-pct",o.textContent="0%",a.append(o," complete"),N(e,t,n,a,C("bsod-code","STOP_CODE: VIBE_EXECUTION_FAILURE")),o}(x);x.hasAttribute("tabindex")||x.setAttribute("tabindex","-1");x.focus({preventScroll:!0});const a=performance.now();function o(t){const i=t-a,s=Math.min(100,i/e.timing.bsodAnimationDuration*100);c(n,`${Math.floor(s)}%`),s<100&&requestAnimationFrame(o)}requestAnimationFrame(o),q.addTimeout(setTimeout(()=>{!function(e,t=null){R(e),t&&N(t)}(w.bsod,x),te(),g.textContent="",ie=[],de=0,re=0,le=s.randBetween(e.asciiArt.minLinesAfter,e.asciiArt.maxLinesAfter),he=!1,xe.close(),ne(),$(),d(t.NORMAL),pe("[ok] reboot complete. nothing was learned.",!0),y?.focus({preventScroll:!0})},e.timing.bsodRebootDelay))}())},e.timing.nukeCountdownInterval))}function Ae(e,t=!0){t&&j(),pe(`[err] ${e}`,!0)}function Ie(){K(),pe("[help] commands: help, /summon, /dance, /panic, /open, /close, /nuke, clear",!0)}function Te(e){if(!xe.element)return void Ae("guard not found.");if(xe.isOpen()===("open"===e))return pe(`[info] guard already ${e}.`,!0),void j();xe.toggle(),pe(`[ok] safety guard ${e}ed.`,!0)}function Ee(){K(),g.textContent="",ie=[],de=0,re=0,le=s.randBetween(e.asciiArt.minLinesAfter,e.asciiArt.maxLinesAfter),pe("[sys] display buffer wiped. evidence deleted.",!0)}const we=new Map([["help",Ie],["/help",Ie],["/summon",function(){if(Math.random()<e.probabilities.summonSuccess){pe(s.pickRandom(h),!0),K()}else Ae("summoning failed: entity refused to materialise.")}],["/dance",function(){w.dance&&_.temporary(w.dance,e.timing.danceDuration,()=>{!function(e,t=6){if(!e)return;const n=[];for(let e=0;e<t;e++){const t=C(`dance-row delay-${e}`,"(>'-')>   <('-'<)   ^('-')^");n.push(t)}N(e,...n)}(w.dance),w.dance.style.display="flex",J()},()=>{w.dance.style.display="none",X.forEach(e=>{try{e.stop&&e.stop(),e.disconnect()}catch(e){}}),X.clear()})}],["/panic",function(){if(!L||!w.panic)return;var a;d(t.PANIC),[S.cpu.bar,S.mem.bar,S.temp.bar].forEach(e=>{e?.classList.remove(n.OK,n.WARN,n.FAIL,n.MELTDOWN),e?.classList.add(n.INSTABILITY)}),c(S.cpu.foot,"process priority: degraded"),c(S.mem.foot,"memory integrity: questionable"),c(S.temp.foot,"thermal status: unstable"),c(S.net.val,"???"),c(S.net.foot,"uplink: unstable | latency: spiking | packet_loss: escalating | status: WARNING"),c(S.cpu.val,"???"),c(S.mem.val,"???"),c(S.temp.val,"???"),c(S.cpu.foot,"process priority: unstable"),c(S.mem.foot,"memory status: fragmentation detected"),c(S.temp.foot,"thermal status: escalating"),(a=L)&&N(a,C("panic-text","!! SYSTEM INSTABILITY DETECTED !!"),C("panic-text","CONTAINMENT FAILURE POSSIBLE"),C("panic-text small","attempting graceful denial...")),O(w.panic,L),pe("[warn] abnormal energy spike in inference chamber",!1),pe("[fail] containment breach flagged. ignoring for now.",!1),pe("[err] escalating to panic handler...",!1),H();const o=q.addInterval(setInterval(()=>{pe("[panic] subsystem meltdown risk: acceptable",!1)},e.timing.panicSpamInterval));q.addTimeout(setTimeout(()=>{q.clear(o),[S.cpu.bar,S.mem.bar,S.temp.bar].forEach(e=>e?.classList.remove(n.INSTABILITY)),ne(),$(),R(w.panic),pe("[ok] crisis averted. nothing was learned.",!1),d(t.NORMAL)},e.timing.panicDuration))}],["/open",()=>Te("open")],["/close",()=>Te("close")],["/nuke",async function(){if(xe.button?.disabled)return Ae("/nuke blocked: safety guard is closed."),void(xe.element&&(xe.element.classList.add("blink"),setTimeout(()=>xe.element?.classList.remove("blink"),e.timing.guardBlinkDuration)));const n=await ve();if(null===n)return pe("[info] launch cancelled. guard closing.",!0),K(),void xe.close();!0===n?(pe("[ok] code accepted. proceeding to launch window.",!0),ke()):function(e="authentication failed"){Ae(`${e}. nuclear sequence disarmed.`,!0),ye(),xe.close(),he=!1,d(t.NORMAL),te(),ne(),$()}("wrong launch code")}],["clear",Ee],["/clear",Ee]]);function Le(e){const t=(e||"").trim().toLowerCase();if(!t)return;const n=we.get(t);n?n():Ae(`unknown command: ${t}`)}v?.addEventListener("click",e=>{const t=e.target.closest("button[data-cmd]");if(!t)return;Le(t.dataset.cmd)}),y?.addEventListener("keydown",e=>{"Enter"===e.key&&(Le(y.value),y.value="")}),window.addEventListener("pointerdown",G,{once:!0}),window.addEventListener("keydown",G,{once:!0});const xe={element:document.getElementById("guard-switch"),button:document.getElementById("nuke-btn"),setState(e){if(!this.element||!this.button)return;this.isOpen()!==e&&(this.element.classList.toggle("open",e),this.element.setAttribute("aria-pressed",String(e)),this.button.disabled=!e,this.element.title=e?"Guard open — click to close":"Guard closed — click to open",K())},toggle(){this.setState(!this.isOpen())},open(){this.setState(!0)},isOpen(){return this.element?.classList.contains("open")??!1},close(){this.setState(!1)}};xe.element&&(xe.element.addEventListener("click",()=>xe.toggle()),xe.element.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),xe.toggle())}))});